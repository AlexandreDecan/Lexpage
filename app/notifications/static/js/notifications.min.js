var notifications_timer_delay=30000;var notifications_menu_button;var notifications_dropdown_button;var notifications_content_list;var notifications_content_url;var notifications_initial_content_url;var notifications_container;var notifications_previous_page=null;var notifications_fetch_failed=false;var notifications_button_template="/notifications/button.html";var notifications_list_template="/notifications/list.html";function notifications_init_display(b,d,c,e,a){notifications_container=b;notifications_menu_button=d;notifications_dropdown_button=c;notifications_content_list=e;notifications_content_url=a;notifications_initial_content_url=a;if($(notifications_content_list)){setInterval(notifications_refresh_fallback,notifications_timer_delay);notifications_refresh();if(ws_client){ws_client.register("notifications","on_connect",notifications_refresh);ws_client.register("notifications","on_message",notifications_websocket_message_dispatch)}}}function notifications_websocket_message_dispatch(a){switch(a.action){case"update_counter":notifications_refresh();break}}function notifications_refresh_fallback(){if(!ws_client||!ws_client.isConnected()){notifications_refresh()}}function notifications_refresh(){$.get(notifications_content_url,function(a){notifications_previous_page=a.previous;if(a.count==0){$(notifications_container).hide()}else{$(notifications_container).show()}$(notifications_dropdown_button).html(nunjucks.render(notifications_button_template,a));$(notifications_content_list).html(nunjucks.render(notifications_list_template,a));$(notifications_menu_button).html(nunjucks.render(notifications_button_template,a));notification_initialize()}).error(function(){if(notifications_previous_page){notifications_fetch_failed=true;notifications_content_url=notifications_previous_page;notifications_previous_page=null;notifications_refresh()}else{if(notifications_fetch_failed){notifications_fetch_failed=false;notifications_content_url=notifications_initial_content_url;notifications_refresh()}else{$(notifications_container).show();$(notifications_dropdown_button).html(nunjucks.render(notifications_button_template,{error:true}));$(notifications_content_list).html(nunjucks.render(notifications_list_template,{error:true}));$(notifications_menu_button).html(nunjucks.render(notifications_button_template,{error:true}))}}})}function notification_initialize(){notifications_fetch_failed=false;$(".notification_list .notification_dismiss a.close").click(function(a){a.stopPropagation()});$(".notification_pagination > div > a").click(function(a){a.stopPropagation()})}function notification_dismiss(b,c){function a(d){notifications_refresh_fallback()}$("#"+c+" a.close").addClass("fa-spinner fa-spin");$.ajax({url:b,type:"DELETE"}).done(a)}function notifications_change_page(a){notifications_content_url=a;notifications_refresh()};