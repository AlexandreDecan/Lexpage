var minichat_timer_delay=30000;var minichat_content;var minichat_content_url;var minichat_post_url;var minichat_form="#minichat_form";var minichat_button="#minichat_form button[type='submit']";var minichat_input_text="#minichat_form input[type='text']";var minichat_chars_output="#minichat_form .minichat-remainingChars";var minichat_notification="#minichat_wrapper .minichat_notification";var minichat_template="/minichat/latests.html";function minichat_init_display(b,a){minichat_content=b;minichat_content_url=a;if(minichat_content){setInterval(minichat_refresh,minichat_timer_delay);minichat_refresh()}}function minichat_refresh(){$.get(minichat_content_url,function(a){data_with_username=$.extend({user:USERNAME},a);$(minichat_content).html(nunjucks.render(minichat_template,data_with_username));replace_invalid_avatar($(minichat_content));activate_tooltips($(minichat_content))})}function minichat_init_post(){minichat_post_url=$(minichat_form).attr("action");$(minichat_button).click(function(a){a.preventDefault();$(minichat_button).find("span").addClass("fa-spinner fa-spin");minichat_post_message()})}function minichat_post_message(){$.post(minichat_post_url,$(minichat_form).serialize()).done(function(c){if(c.anchors.length>0){var b;if(c.anchors.length>1){var d=c.anchors.join(", ");var a=d.lastIndexOf(", ");b=d.substr(0,a)+" et"+d.substr(a+1)}else{b=c.anchors[0]}$(minichat_notification).html("Une notification a été envoyée à "+b+".");$(minichat_notification).show()}else{$(minichat_notification).hide()}$(minichat_button).find("span").removeClass("fa-spinner fa-spin fa-warning btn-warning");$(minichat_input_text).val("");minichat_update_chars_count();minichat_refresh()}).fail(function(a){$(minichat_button).find("span").removeClass("fa-spinner fa-spin").addClass("fa-warning");minichat_refresh()})}function minichat_update_chars_count(){var b=$(minichat_input_text).attr("maxlength")-$(minichat_input_text).val().length;var a="";if(b>1){a="s"}$(minichat_input_text).parent().toggleClass("has-warning",b==0);$(minichat_chars_output).text(b+"  caractère"+a+" restant"+a)}function minichat_init_remaining_chars(){minichat_update_chars_count();$(minichat_input_text).change(minichat_update_chars_count);$(minichat_input_text).keyup(minichat_update_chars_count)};